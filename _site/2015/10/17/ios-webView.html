<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="baidu-site-verification" content="w9Akh6dPe4" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<!--[if lte IE 8]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->

<title>UIWebView和WKWebView的使用及js交互 | 曾绍明的博客</title>
<meta name="author" content="曾绍明">




<link rel="shortcut icon" href="" />

<link rel="stylesheet" type="text/css" href="/assets/css/style.css">

<link href="/pages/rss.xml" rel="alternate" title="曾绍明的博客" type="application/atom+xml">



  </head>
  <body>
        <aside id="sidebar">
  <nav id="tags">
    <a href="/index.html" id="avatar" style="background-image:url(https://avatars1.githubusercontent.com/u/15245912)"></a>

    <ul id="tags__ul">
      <li id="pl__all" class="tags__li tags-btn active">所有文章</li>
       
        <li id="技术" class="tags__li tags-btn">技术</li>
       
        <li id="web前端" class="tags__li tags-btn">web前端</li>
       
        <li id="专题" class="tags__li tags-btn">专题</li>
       
        <li id="iOS" class="tags__li tags-btn">iOS</li>
       
        <li id="生活" class="tags__li tags-btn">生活</li>
       
        <li id="react-native" class="tags__li tags-btn">react-native</li>
       
        <li id="其他" class="tags__li tags-btn">其他</li>
       
        <li id="IoT" class="tags__li tags-btn">IoT</li>
      
    </ul>

    <div id="tags__bottom">
      <a href="http://github.com/ZSMSimon" id="icon-github" class="tags-btn fontello" target="_blank"></a>
      <a href="/pages/rss.xml" id="icon-feed" class="tags-btn fontello" target="_blank"></a>
      <a href="mailto:ZSMSimon@163.com" id="icon-email" class="tags-btn fontello"></a>
    </div>
  </nav> <!-- end #tags -->

  <div id="posts-list">
    <form action="" id="search-form">
      <a href="/index.html" id="mobile-avatar" style="background-image:url(https://avatars1.githubusercontent.com/u/15245912)"></a>
      <!-- NOTE: input field is disabled by default -->
      <input id="search-input" type="text" placeholder="Search..." >
    </form>

    <nav id="pl__container">
    
      <a class="IoT pl__all" href="/2017/05/16/JavaScript-mqtt-temperaturedemo.html"><span class="pl__circle"></span><span class="pl__title">IoT技术选型及模型设计的思考</span><span class="pl__date">17/05/16</span></a>
    
      <a class="IoT pl__all" href="/2017/05/02/hello-nodemcu.html"><span class="pl__circle"></span><span class="pl__title">hello nodemcu</span><span class="pl__date">17/05/02</span></a>
    
      <a class="其他 pl__all" href="/2017/03/16/Recruitment.html"><span class="pl__circle"></span><span class="pl__title">阿里云iot事业部招聘信息</span><span class="pl__date">17/03/16</span></a>
    
      <a class="技术 pl__all" href="/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html"><span class="pl__circle"></span><span class="pl__title">知乎live：一小时蓝牙科普 文字整理版</span><span class="pl__date">17/01/23</span></a>
    
      <a class="web前端 pl__all" href="/2016/12/08/eslint-guide.html"><span class="pl__circle"></span><span class="pl__title">ESLint使用</span><span class="pl__date">16/12/08</span></a>
    
      <a class="其他 pl__all" href="/2016/12/06/how-to-fupan.html"><span class="pl__circle"></span><span class="pl__title">柳传志：我的复盘方法论</span><span class="pl__date">16/12/06</span></a>
    
      <a class="react-native pl__all" href="/2016/11/14/react-native-flux%E6%95%B0%E6%8D%AE%E6%B5%81.html"><span class="pl__circle"></span><span class="pl__title">flux数据流在rn中的使用</span><span class="pl__date">16/11/14</span></a>
    
      <a class="专题 pl__all" href="/2016/05/09/iOS-networking-0.html"><span class="pl__circle"></span><span class="pl__title">iOS 网络请求专题</span><span class="pl__date">16/05/09</span></a>
    
      <a class="iOS pl__all" href="/2016/04/03/iOS-JavaScriptCore.html"><span class="pl__circle"></span><span class="pl__title">iOS JavaScriptCore使用</span><span class="pl__date">16/04/03</span></a>
    
      <a class="iOS pl__all" href="/2016/04/02/iOS-3DTouch-3.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(三) Force Properties-按压力度</span><span class="pl__date">16/04/02</span></a>
    
      <a class="iOS pl__all" href="/2016/04/01/iOS-3DTouch-2.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(二) peek and pop - 预览和弹出</span><span class="pl__date">16/04/01</span></a>
    
      <a class="iOS pl__all" href="/2016/03/21/iOS-3DTouch-1.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(一) Home Screen Quick Actions</span><span class="pl__date">16/03/21</span></a>
    
      <a class="iOS pl__all" href="/2016/03/10/iOS-unit-test.html"><span class="pl__circle"></span><span class="pl__title">iOS单元测试</span><span class="pl__date">16/03/10</span></a>
    
      <a class="iOS pl__all" href="/2016/02/29/iOS-objc-styleguide.html"><span class="pl__circle"></span><span class="pl__title">iOS objc编程规范</span><span class="pl__date">16/02/29</span></a>
    
      <a class="iOS pl__all" href="/2016/02/13/ios-networking-5.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（五）网络请求中的cookie</span><span class="pl__date">16/02/13</span></a>
    
      <a class="iOS pl__all" href="/2016/02/09/ios-networking-4.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（四） http异步文件上传和下载以及进度指示</span><span class="pl__date">16/02/09</span></a>
    
      <a class="iOS pl__all" href="/2016/02/04/ios-networking-3.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（三） http异步请求和https认证</span><span class="pl__date">16/02/04</span></a>
    
      <a class="iOS pl__all" href="/2016/02/03/ios-networking-2.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（二） http异步队列请求</span><span class="pl__date">16/02/03</span></a>
    
      <a class="iOS pl__all" href="/2016/02/03/ios-networking-1.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（一） http同步请求</span><span class="pl__date">16/02/03</span></a>
    
      <a class="react-native pl__all" href="/2016/02/02/react-native-demo.html"><span class="pl__circle"></span><span class="pl__title">react-native（二） 自己写的react-native学习demo和整理的tips</span><span class="pl__date">16/02/02</span></a>
    
      <a class="react-native pl__all" href="/2016/01/11/react-native-helloworld.html"><span class="pl__circle"></span><span class="pl__title">react-native（一） hello world</span><span class="pl__date">16/01/11</span></a>
    
      <a class="iOS pl__all" href="/2016/01/06/iOS-app-versions.html"><span class="pl__circle"></span><span class="pl__title">api如何设计才能支撑多个不同版本的app共存</span><span class="pl__date">16/01/06</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/31/playwith-imageToAscii.html"><span class="pl__circle"></span><span class="pl__title">那些好玩的nodejs插件 - 把图片转为ascii</span><span class="pl__date">15/12/31</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/10/fe-componentization.html"><span class="pl__circle"></span><span class="pl__title">前端开发框架 - seajs+handlebars模块化开发</span><span class="pl__date">15/12/10</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/06/fe-nginx-usage.html"><span class="pl__circle"></span><span class="pl__title">mac环境nginx的安装和使用</span><span class="pl__date">15/12/06</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/03/fe-js-handlebars.html"><span class="pl__circle"></span><span class="pl__title">handlerbars的使用及模板预编译</span><span class="pl__date">15/12/03</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/01/fe-engineering-gulp.html"><span class="pl__circle"></span><span class="pl__title">gulp自动构建工具教程</span><span class="pl__date">15/12/01</span></a>
    
      <a class="web前端 pl__all" href="/2015/11/27/fe-environment.html"><span class="pl__circle"></span><span class="pl__title">前端开发工具和环境搭建</span><span class="pl__date">15/11/27</span></a>
    
      <a class="web前端 pl__all" href="/2015/11/26/rem-em-px.html"><span class="pl__circle"></span><span class="pl__title">css3属性rem的使用</span><span class="pl__date">15/11/26</span></a>
    
      <a class="生活 pl__all" href="/2015/11/26/mylift-github.html"><span class="pl__circle"></span><span class="pl__title">我每天都在github上做些什么</span><span class="pl__date">15/11/26</span></a>
    
      <a class="iOS pl__all" href="/2015/11/24/iOS-affine-transfermation-animation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（七）仿射变换-CGAffineTransform</span><span class="pl__date">15/11/24</span></a>
    
      <a class="iOS pl__all" href="/2015/11/22/iOS-library-spring.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（六）swift动画库spring使用和代码拆解</span><span class="pl__date">15/11/22</span></a>
    
      <a class="iOS pl__all" href="/2015/11/16/iOS-Implicit-Animation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（五）layer隐式动画</span><span class="pl__date">15/11/16</span></a>
    
      <a class="iOS pl__all" href="/2015/11/06/iOS-controller-transitioning.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（四）controller间的自定义过渡效果</span><span class="pl__date">15/11/06</span></a>
    
      <a class="iOS pl__all" href="/2015/11/01/iOS-MotionEffects.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（三）MotionEffects</span><span class="pl__date">15/11/01</span></a>
    
      <a class="iOS pl__all" href="/2015/10/30/iOS-UIKit-Dynamics.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（二）UIKit力学行为</span><span class="pl__date">15/10/30</span></a>
    
      <a class="iOS pl__all" href="/2015/10/30/iOS-Animation-UIViewAndCoreAnimation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（一）UIView动画和CoreAnimation</span><span class="pl__date">15/10/30</span></a>
    
      <a class="专题 pl__all" href="/2015/10/29/iOS-animation-0.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效专题（零）- 大纲和计划</span><span class="pl__date">15/10/29</span></a>
    
      <a class="iOS pl__all" href="/2015/10/17/ios-webView.html"><span class="pl__circle"></span><span class="pl__title">UIWebView和WKWebView的使用及js交互</span><span class="pl__date">15/10/17</span></a>
    
      <a class="iOS pl__all" href="/2015/10/06/ios-swift-quick.html"><span class="pl__circle"></span><span class="pl__title">swift5分钟语法速记</span><span class="pl__date">15/10/06</span></a>
    
      <a class="iOS pl__all" href="/2015/09/20/ios-macro.html"><span class="pl__circle"></span><span class="pl__title">ios宏的使用和技巧</span><span class="pl__date">15/09/20</span></a>
    
      <a class="iOS pl__all" href="/2015/09/11/ios-BLE-4.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（四）BabyBluetooth蓝牙库介绍</span><span class="pl__date">15/09/11</span></a>
    
      <a class="iOS pl__all" href="/2015/09/07/ios-BLE-3.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（三）app作为外设被连接的实现</span><span class="pl__date">15/09/07</span></a>
    
      <a class="iOS pl__all" href="/2015/09/02/ios-draw-Graffiti-2.html"><span class="pl__circle"></span><span class="pl__title">ios绘图demo,做一个涂鸦板(下)</span><span class="pl__date">15/09/02</span></a>
    
      <a class="web前端 pl__all" href="/2015/08/29/go-deep-into-unsilder.js.html"><span class="pl__circle"></span><span class="pl__title">深入理解unslider.js源码</span><span class="pl__date">15/08/29</span></a>
    
      <a class="生活 pl__all" href="/2015/08/23/life-keyboardAndHHKB.html"><span class="pl__circle"></span><span class="pl__title">键盘那些事，hhkb开箱</span><span class="pl__date">15/08/23</span></a>
    
      <a class="技术 pl__all" href="/2015/08/22/github-ImagesUploadWebSite.html"><span class="pl__circle"></span><span class="pl__title">自己markdown博客的图床程序</span><span class="pl__date">15/08/22</span></a>
    
      <a class="iOS pl__all" href="/2015/08/19/ios-ThreadAndAsynchronization.html"><span class="pl__circle"></span><span class="pl__title">ios的线程和同步异步操作</span><span class="pl__date">15/08/19</span></a>
    
      <a class="iOS pl__all" href="/2015/08/14/ios-BLE-2.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（二）ios连接外设的代码实现</span><span class="pl__date">15/08/14</span></a>
    
      <a class="iOS pl__all" href="/2015/07/26/ios-draw-Graffiti.html"><span class="pl__circle"></span><span class="pl__title">ios绘图demo,做一个涂鸦板(上)</span><span class="pl__date">15/07/26</span></a>
    
      <a class="iOS pl__all" href="/2015/07/25/ios-draw-base.html"><span class="pl__circle"></span><span class="pl__title">ios绘图基础</span><span class="pl__date">15/07/25</span></a>
    
      <a class="iOS pl__all" href="/2015/07/17/ios-BLE-1.html"><span class="pl__circle"></span><span class="pl__title">iOS蓝牙开发（一）蓝牙相关基础知识</span><span class="pl__date">15/07/17</span></a>
    
      <a class="专题 pl__all" href="/2015/07/17/ios-BLE-0.html"><span class="pl__circle"></span><span class="pl__title">iOS蓝牙的开发专题</span><span class="pl__date">15/07/17</span></a>
    
      <a class="技术 pl__all" href="/2015/07/07/mybatis.html"><span class="pl__circle"></span><span class="pl__title">MyBatis简单使用的demo</span><span class="pl__date">15/07/07</span></a>
    
      <a class="技术 pl__all" href="/2015/07/06/rabbitmq.html"><span class="pl__circle"></span><span class="pl__title">RabbitMQ使用</span><span class="pl__date">15/07/06</span></a>
    
      <a class="iOS pl__all" href="/2015/06/14/ios-library-masonry.html"><span class="pl__circle"></span><span class="pl__title">Masonry的使用</span><span class="pl__date">15/06/14</span></a>
    
      <a class="专题 pl__all" href="/2015/06/14/ios-library-0.html"><span class="pl__circle"></span><span class="pl__title">iOS中那些好用的第三方库</span><span class="pl__date">15/06/14</span></a>
    
      <a class="iOS pl__all" href="/2015/05/29/ios-develop-tool.html"><span class="pl__circle"></span><span class="pl__title">提高iOS开发效率的工具</span><span class="pl__date">15/05/29</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-4.html"><span class="pl__circle"></span><span class="pl__title">Spring 文件上传</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-3.html"><span class="pl__circle"></span><span class="pl__title">Spring- Hibernate数据基本操作</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-2.html"><span class="pl__circle"></span><span class="pl__title">Spring RestController 请求参数详解</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-1.html"><span class="pl__circle"></span><span class="pl__title">Spring和hibernate的maven配置</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/tomcat-domain-name.html"><span class="pl__circle"></span><span class="pl__title">tomcat部署绑定多个域名</span><span class="pl__date">15/05/28</span></a>
    
      <a class="专题 pl__all" href="/2015/05/28/spring-0.html"><span class="pl__circle"></span><span class="pl__title">Spring4+hibernate专题</span><span class="pl__date">15/05/28</span></a>
    
      <a class="web前端 pl__all" href="/2015/04/29/css-selector.html"><span class="pl__circle"></span><span class="pl__title">css选择器的用法</span><span class="pl__date">15/04/29</span></a>
    
      <a class="技术 pl__all" href="/2014/02/12/how-to-deploy-a-blog-on-github-by-jekyll.html"><span class="pl__circle"></span><span class="pl__title">在Github上搭建Jekyll博客和创建主题</span><span class="pl__date">14/02/12</span></a>
    
      <a class="技术 pl__all" href="/2013/04/23/opensource-licenses.html"><span class="pl__circle"></span><span class="pl__title">五中常见的开源协议整理(BSD,Apache,GPL,LGPL,MIT)</span><span class="pl__date">13/04/23</span></a>
    
    </nav>
  </div> <!-- end #posts-list -->
</aside> <!-- end #sidebar -->
    <div id="post">
      <div id="pjax">
        <article id="post__content">
    <h1 id="post__title" data-identifier="20151017">UIWebView和WKWebView的使用及js交互</h1>
    <blockquote>
  <p>web页面和app直接的交互是很常见的东西，之前尝试过flex和js的相互调用以及android和js的相互调用，却只有ios没试过，据说比较复杂。周末花了点时间研究了一下，确实和其他的不太一样，但是
也不见复杂。</p>
</blockquote>

<h2 id="要知道的事情">要知道的事情</h2>

<p>ios的webview有2个类，一个叫UIWebView，另一个是WKWebView。两者的基础方法都差不多，本文重点是后者，他是取代UIWebView出现的，在app开发者若不需要兼容ios8之前版本，都应该使用WKWebVIew。</p>

<p>WKWebView 是苹果在 iOS 8 中引入的新组件，目的是给出一个新的高性能的 Web View 解决方案，摆脱过去 UIWebView 的老旧笨重特别是内存占用量巨大的问题，它使用Nitro JavaScript引擎，这意味着所有第三方浏览器运行JavaScript将会跟safari一样快.</p>

<p>ios9默认是不允许加载http请求的，对于webview，加载http网页也是不允许的。可以通过修改info.plist取消http限制</p>

<p>在项目中找到info.plist，源文件形式打开，添加下面内容</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="nt">&lt;key&gt;</span>NSAppTransportSecurity<span class="nt">&lt;/key&gt;</span>
    <span class="nt">&lt;dict&gt;</span>
        <span class="nt">&lt;key&gt;</span>NSAllowsArbitraryLoads<span class="nt">&lt;/key&gt;</span>
        <span class="nt">&lt;true/&gt;</span>
    <span class="nt">&lt;/dict&gt;</span>

</code></pre></div></div>

<p>dome截图</p>

<p><img src="http://localhost:4000/assets/uploads/webview0.png" alt="" /></p>

<p><img src="http://localhost:4000/assets/uploads/webview1.png" alt="" /></p>

<h2 id="大纲">大纲</h2>

<ul>
  <li>UIWebView使用
    <ul>
      <li>加载网页或本地页面</li>
      <li>app调js方法</li>
      <li>js调app方法</li>
    </ul>
  </li>
  <li>WKWebView的使用
    <ul>
      <li>加载页面，前进，后退，刷新，进度条</li>
      <li>前进，后退，刷新，进度条</li>
      <li>js中alert的拦截</li>
      <li>app调js方法</li>
      <li>js调app方法</li>
      <li>webView生命周期和跳转代理</li>
    </ul>
  </li>
  <li>web页面</li>
  <li>文章demo</li>
  <li>参考文章</li>
</ul>

<h2 id="uiwebview使用">UIWebView使用</h2>
<hr />
<blockquote>
  <p>UIVebView现在已经弃用，ios8以上都应该用新的WKWebview，所以UIWebView我就随意说说，大家随意看看。</p>
</blockquote>

<h3 id="加载网页或本地页面">加载网页或本地页面</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="c1">//从本地加载html</span>
    <span class="k">let</span> <span class="nv">path</span><span class="p">:</span><span class="kt">String</span><span class="o">!</span> <span class="o">=</span> <span class="kt">NSBundle</span><span class="o">.</span><span class="nf">mainBundle</span><span class="p">()</span><span class="o">.</span><span class="nf">pathForResource</span><span class="p">(</span><span class="s">"index"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"html"</span><span class="p">)</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">loadRequest</span><span class="p">(</span><span class="kt">NSURLRequest</span><span class="p">(</span><span class="kt">URL</span><span class="p">:</span> <span class="kt">NSURL</span><span class="o">.</span><span class="nf">fileURLWithPath</span><span class="p">(</span><span class="n">path</span><span class="p">)))</span>

    <span class="c1">//从网络加载</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">loadRequest</span><span class="p">(</span><span class="kt">NSURLRequest</span><span class="p">(</span><span class="kt">URL</span><span class="p">:</span> <span class="kt">NSURL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://www.bing.com"</span><span class="p">)</span><span class="o">!</span><span class="p">))</span>

</code></pre></div></div>

<p>注意点:</p>
<ol>
  <li>ios9默认不能加载http请求，需要声明</li>
  <li>uiwebView网络请求会进入<code class="highlighter-rouge">ternal  func webView(webView: UIWebView, shouldStartLoadWithRequest request: NSURLRequest, navigationType: UIWebViewNavigationType) -&gt; Bool</code> 委托，委托中若return false，也不会继续加载</li>
</ol>

<h3 id="app调js方法">app调js方法</h3>

<p>app调用js方法使用的是 <code class="highlighter-rouge">webView.stringByEvaluatingJavaScriptFromString()</code> 这个方法。它可以直接执行一段js代码</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">//调用js无参数的方法</span>
     <span class="n">webView</span><span class="o">.</span><span class="nf">stringByEvaluatingJavaScriptFromString</span><span class="p">(</span><span class="s">"hi()"</span><span class="p">)</span>

    <span class="c1">//调用js有参数的方法hello(msg)</span>
    <span class="k">let</span> <span class="nv">js</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"hello('%@')"</span><span class="p">,</span> <span class="s">"liuyanwei"</span><span class="p">)</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">stringByEvaluatingJavaScriptFromString</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>

    <span class="c1">//调用js的参数为json对象</span>
    <span class="k">let</span> <span class="nv">js</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">format</span><span class="p">:</span> <span class="s">"hello(%@)"</span><span class="p">,</span> <span class="s">"{'obj':'liuyanwei'}"</span><span class="p">)</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">stringByEvaluatingJavaScriptFromString</span><span class="p">(</span><span class="n">js</span><span class="p">)</span>

     <span class="c1">//从文件中加载一段js代码然后执行</span>
     <span class="k">do</span><span class="p">{</span>
         <span class="k">let</span> <span class="nv">jsString</span> <span class="o">=</span> <span class="k">try</span> <span class="kt">String</span><span class="p">(</span><span class="nv">contentsOfFile</span><span class="p">:</span> <span class="kt">NSBundle</span><span class="o">.</span><span class="nf">mainBundle</span><span class="p">()</span><span class="o">.</span><span class="nf">pathForResource</span><span class="p">(</span><span class="s">"test"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"js"</span><span class="p">)</span><span class="o">!</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="kt">NSUTF8StringEncoding</span><span class="p">)</span>
         <span class="k">self</span><span class="o">.</span><span class="n">webView</span><span class="o">.</span><span class="nf">stringByEvaluatingJavaScriptFromString</span><span class="p">(</span><span class="n">jsString</span><span class="p">)</span>
     <span class="p">}</span>
     <span class="k">catch</span><span class="p">{}</span>

    <span class="c1">//直接执行alert</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">stringByEvaluatingJavaScriptFromString</span><span class="p">(</span><span class="s">"alert('hi')"</span><span class="p">)</span>

    <span class="c1">//执行有返回值的js函数</span>
    <span class="kt">NSLog</span><span class="p">(</span><span class="s">"%@"</span><span class="p">,</span> <span class="n">webView</span><span class="o">.</span><span class="nf">stringByEvaluatingJavaScriptFromString</span><span class="p">(</span><span class="s">"getName()"</span><span class="p">)</span><span class="o">!</span><span class="p">)</span>

</code></pre></div></div>

<p>相关的js代码</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="kd">var</span> <span class="nx">hi</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="nx">alert</span><span class="p">(</span><span class="s2">"hello"</span><span class="p">)</span>
	<span class="nx">$</span><span class="p">(</span><span class="s2">".info"</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s2">"hi"</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">hello</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
	<span class="nx">alert</span><span class="p">(</span><span class="s2">"hello "</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">)</span>
	<span class="k">if</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">obj</span> <span class="o">!=</span> <span class="kc">undefined</span><span class="p">)</span>
		<span class="nx">alert</span><span class="p">(</span><span class="nx">msg</span><span class="p">.</span><span class="nx">obj</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">getName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(){</span>
	<span class="k">return</span> <span class="s2">"liuyanwei"</span>
<span class="p">}</span>


</code></pre></div></div>

<h3 id="js调app方法">js调app方法</h3>

<p>很多人觉得，为什么UIWebView中，js调用app的方式怎么那么奇怪，其实应该这样说，UIWebView没有办法直接使用js调用app，但是可以通过拦截request的方式间接实现js调用app方法。</p>

<p>既然是拦截url，那你就可以任意方式去规定想要调用的url的路径和app中方法转换的方式。我这里使用协议和路径的方式，例如我拦截到的url是 “hello://hello_liuyanwei” ，我就把hello当做想调用的方法，路径当做参数。这种方式不一定好，但是使用起来还是挺方便的。</p>

<p>js中调用app的方法如下：</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="c1">//这段代码是原生js代码，在js中的作用是做页面跳转</span>
<span class="c1">//webView通过拦截url请求方式拦截到request，通过解析从而调用 ios hello方法，参数是hello_liuyanwei</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">location</span> <span class="o">=</span> <span class="s2">"hello://hello_liuyanwei"</span><span class="p">;</span>

</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="c1">//webView 需要实现UIWebViewDelegate委托方法</span>
    <span class="c1">// class ViewController: UIViewController,UIWebViewDelegate ....</span>
    <span class="c1">// webView.delegate = self</span>

    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="nv">webView</span><span class="p">:</span> <span class="kt">UIWebView</span><span class="p">,</span> <span class="n">shouldStartLoadWithRequest</span> <span class="nv">request</span><span class="p">:</span> <span class="kt">NSURLRequest</span><span class="p">,</span> <span class="nv">navigationType</span><span class="p">:</span> <span class="kt">UIWebViewNavigationType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Bool</span><span class="p">{</span>

        <span class="c1">//如果请求协议是hello 这里的hello来自js的调用，在js中设为 document.location = "hello://liuyanwei 你好";</span>
        <span class="c1">//scheme：hello ，msg：liuyanwei 你好</span>
        <span class="c1">//通过url拦截的方式，作为对ios原生方法的呼叫</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="kt">URL</span><span class="p">?</span><span class="o">.</span><span class="n">scheme</span> <span class="o">==</span> <span class="s">"hello"</span><span class="p">{</span>
            <span class="k">let</span> <span class="nv">method</span><span class="p">:</span><span class="kt">String</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="kt">URL</span><span class="p">?</span><span class="o">.</span><span class="n">scheme</span> <span class="k">as</span> <span class="kt">String</span><span class="o">!</span>
            <span class="k">let</span> <span class="nv">sel</span> <span class="o">=</span>  <span class="kt">Selector</span><span class="p">(</span><span class="n">method</span><span class="o">+</span><span class="s">":"</span><span class="p">)</span>
            <span class="k">self</span><span class="o">.</span><span class="nf">performSelector</span><span class="p">(</span><span class="n">sel</span><span class="p">,</span> <span class="nv">withObject</span><span class="p">:</span><span class="n">request</span><span class="o">.</span><span class="kt">URL</span><span class="p">?</span><span class="o">.</span><span class="n">host</span><span class="p">)</span>
            <span class="n">request</span><span class="o">.</span><span class="kt">URL</span><span class="p">?</span><span class="o">.</span><span class="n">path</span>
            <span class="c1">//如果return true ，页面加载request，我们只是当做协议使用所以不能页面跳转</span>
            <span class="k">return</span> <span class="kc">false</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="kc">true</span>
    <span class="p">}</span>


</code></pre></div></div>

<p>最后说一下关于js调用app的返回值。app调js可以有返回值，但是js调app是通过间接的拦截request方式实现，它根本就不算方法调用，所以应该是不存在可以直接产生返回值的（如果不对欢迎指正）。当然如果需要app对js的调用有所响应，可以通过回叫函数的方式回应js。可以在调用app的时候增加一个js回叫函数名
app在处理完之后可以呼叫回叫函数并把需要的参数通过回叫函数的方式进行传递。</p>

<h2 id="wkwebview的使用">WKWebView的使用</h2>
<hr />

<p>WKWebVIew是UIWebView的代替品，新的WebKit框架把原来的功能拆分成许多小类。本例中主要用到了WKNavigationDelegate,WKUIDelegate,WKScriptMessageHandler三个委托和配置类WKWebViewConfiguration去实现webView的request控制，界面控制，js交互，alert重写等功能。
使用WKWebView需要引入<code class="highlighter-rouge">#import &lt;WebKit/WebKit.h&gt;</code></p>

<h3 id="加载页面配置委托和手势等">加载页面，配置委托和手势等</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="c1">//加载页面</span>
    <span class="n">config</span> <span class="o">=</span> <span class="kt">WKWebViewConfiguration</span><span class="p">()</span>
    <span class="c1">//设置位置和委托</span>
    <span class="n">webView</span> <span class="o">=</span> <span class="kt">WKWebView</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">webWrap</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
    <span class="n">webView</span><span class="o">.</span><span class="n">navigationDelegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="n">webView</span><span class="o">.</span><span class="kt">UIDelegate</span> <span class="o">=</span> <span class="k">self</span>
    <span class="k">self</span><span class="o">.</span><span class="n">webWrap</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="n">webView</span><span class="p">)</span>

    <span class="c1">//加载网页</span>
    <span class="c1">//webView.loadRequest(NSURLRequest(URL: NSURL(string: "https://www.bing.com")!))</span>

    <span class="c1">//加载本地页面</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">loadRequest</span><span class="p">(</span><span class="kt">NSURLRequest</span><span class="p">(</span><span class="kt">URL</span><span class="p">:</span> <span class="kt">NSURL</span><span class="o">.</span><span class="nf">fileURLWithPath</span><span class="p">(</span><span class="kt">NSBundle</span><span class="o">.</span><span class="nf">mainBundle</span><span class="p">()</span><span class="o">.</span><span class="nf">pathForResource</span><span class="p">(</span><span class="s">"index"</span><span class="p">,</span> <span class="nv">ofType</span><span class="p">:</span> <span class="s">"html"</span><span class="p">)</span><span class="o">!</span><span class="p">)))</span>
    <span class="c1">//允许手势，后退前进等操作</span>
     <span class="n">webView</span><span class="o">.</span><span class="n">allowsBackForwardNavigationGestures</span> <span class="o">=</span> <span class="kc">true</span>

</code></pre></div></div>

<h3 id="前进后退刷新进度条">前进，后退，刷新，进度条</h3>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//前进</span>
<span class="n">webView</span><span class="o">.</span><span class="nf">goBack</span><span class="p">()</span>
<span class="c1">//后退</span>
<span class="n">webView</span><span class="o">.</span><span class="nf">goForward</span><span class="p">()</span>
<span class="c1">//刷新</span>
<span class="k">let</span> <span class="nv">request</span> <span class="o">=</span> <span class="kt">NSURLRequest</span><span class="p">(</span><span class="kt">URL</span><span class="p">:</span><span class="n">webView</span><span class="o">.</span><span class="kt">URL</span><span class="o">!</span><span class="p">)</span>
<span class="n">webView</span><span class="o">.</span><span class="nf">loadRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>

<span class="c1">//监听是否可以前进后退，修改btn.enable属性</span>
<span class="n">webView</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKeyPath</span><span class="p">:</span> <span class="s">"loading"</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="kt">New</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="c1">//监听加载进度</span>
<span class="n">webView</span><span class="o">.</span><span class="nf">addObserver</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKeyPath</span><span class="p">:</span> <span class="s">"estimatedProgress"</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="o">.</span><span class="kt">New</span><span class="p">,</span> <span class="nv">context</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

<span class="c1">//重写self的kvo方法</span>
<span class="k">override</span> <span class="kd">func</span> <span class="nf">observeValueForKeyPath</span><span class="p">(</span><span class="nv">keyPath</span><span class="p">:</span> <span class="kt">String</span><span class="p">?,</span> <span class="n">ofObject</span> <span class="nv">object</span><span class="p">:</span> <span class="kt">AnyObject</span><span class="p">?,</span> <span class="nv">change</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span> <span class="p">:</span> <span class="kt">AnyObject</span><span class="p">]?,</span> <span class="nv">context</span><span class="p">:</span> <span class="kt">UnsafeMutablePointer</span><span class="o">&lt;</span><span class="kt">Void</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">keyPath</span> <span class="o">==</span> <span class="s">"loading"</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">gobackBtn</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">webView</span><span class="o">.</span><span class="n">canGoBack</span>
        <span class="n">forwardBtn</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="n">webView</span><span class="o">.</span><span class="n">canGoForward</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">keyPath</span> <span class="o">==</span> <span class="s">"estimatedProgress"</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//progress是UIProgressView</span>
        <span class="n">progress</span><span class="o">.</span><span class="n">hidden</span> <span class="o">=</span> <span class="n">webView</span><span class="o">.</span><span class="n">estimatedProgress</span><span class="o">==</span><span class="mi">1</span>
        <span class="n">progress</span><span class="o">.</span><span class="nf">setProgress</span><span class="p">(</span><span class="kt">Float</span><span class="p">(</span><span class="n">webView</span><span class="o">.</span><span class="n">estimatedProgress</span><span class="p">),</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>


</code></pre></div></div>

<h3 id="js中alert的拦截">js中alert的拦截</h3>

<p>在WKWebview中，js的alert是不会出现任何内容的，你必须重写<code class="highlighter-rouge">WKUIDelegate</code>委托的<code class="highlighter-rouge">runJavaScriptAlertPanelWithMessage message</code>方法，自己处理alert。类似的还有Confirm和prompt也和alert类似，这里我只以alert为例。</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">//alert捕获</span>
    <span class="kd">func</span> <span class="nf">webView</span><span class="p">(</span><span class="nv">webView</span><span class="p">:</span> <span class="kt">WKWebView</span><span class="p">,</span> <span class="n">runJavaScriptAlertPanelWithMessage</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="n">initiatedByFrame</span> <span class="nv">frame</span><span class="p">:</span> <span class="kt">WKFrameInfo</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="p">()</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">//</span>
        <span class="nf">completionHandler</span><span class="p">()</span>
        <span class="k">let</span> <span class="nv">alert</span> <span class="o">=</span> <span class="kt">UIAlertController</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"ios-alert"</span><span class="p">,</span> <span class="nv">message</span><span class="p">:</span> <span class="s">"</span><span class="se">\(</span><span class="n">message</span><span class="se">)</span><span class="s">"</span><span class="p">,</span> <span class="nv">preferredStyle</span><span class="p">:</span> <span class="o">.</span><span class="kt">Alert</span><span class="p">)</span>
        <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"ok"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="kt">Default</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span><span class="kc">nil</span><span class="p">))</span>
        <span class="n">alert</span><span class="o">.</span><span class="nf">addAction</span><span class="p">(</span><span class="kt">UIAlertAction</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"cancel"</span><span class="p">,</span> <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="kt">Cancel</span><span class="p">,</span> <span class="nv">handler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">))</span>
        <span class="k">self</span><span class="o">.</span><span class="nf">presentViewController</span><span class="p">(</span><span class="n">alert</span><span class="p">,</span> <span class="nv">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

    <span class="p">}</span>

</code></pre></div></div>

<h3 id="app调js方法-1">app调js方法</h3>

<p>WKWebView调用js方法和UIWebView类似，一个是evaluateJavaScript，一个是stringByEvaluatingJavaScriptFromString。获取返回值的方式不同，WKWebView用的是回叫函数获取返回值</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="c1">//直接调用js</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">evaluateJavaScript</span><span class="p">(</span><span class="s">"hi()"</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="c1">//调用js带参数</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">evaluateJavaScript</span><span class="p">(</span><span class="s">"hello('liuyanwei')"</span><span class="p">,</span> <span class="nv">completionHandler</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
    <span class="c1">//调用js获取返回值</span>
    <span class="n">webView</span><span class="o">.</span><span class="nf">evaluateJavaScript</span><span class="p">(</span><span class="s">"getName()"</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">any</span><span class="p">,</span><span class="n">error</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span> <span class="k">in</span>
        <span class="kt">NSLog</span><span class="p">(</span><span class="s">"%@"</span><span class="p">,</span> <span class="n">any</span> <span class="k">as!</span> <span class="kt">String</span><span class="p">)</span>
    <span class="p">}</span>

</code></pre></div></div>

<h3 id="js调app方法-1">js调app方法</h3>

<p>UIwebView没有js调app的方法主要有2种实现，一种是通过拦截request的方式间接实现，另一种是使用JavaScriptCore的jsContext注册objc对象或使用JSExport协议导出Native对象的方式。本文主要介绍第一种实现，第二种实现方式参考后续文章 JavaScriptCore的使用教程</p>

<p>1：注册handler需要在webView初始化之前，如示例，注册了一个webViewApp的handler</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="n">config</span> <span class="o">=</span> <span class="kt">WKWebViewConfiguration</span><span class="p">()</span>
         <span class="c1">//注册js方法</span>
        <span class="n">config</span><span class="o">.</span><span class="n">userContentController</span><span class="o">.</span><span class="nf">addScriptMessageHandler</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">name</span><span class="p">:</span> <span class="s">"webViewApp"</span><span class="p">)</span>
        <span class="n">webView</span> <span class="o">=</span> <span class="kt">WKWebView</span><span class="p">(</span><span class="nv">frame</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">webWrap</span><span class="o">.</span><span class="n">frame</span><span class="p">,</span> <span class="nv">configuration</span><span class="p">:</span> <span class="n">config</span><span class="p">)</span>
</code></pre></div></div>

<p>2：处理handler委托。ViewController实现WKScriptMessageHandler委托的<code class="highlighter-rouge">func userContentController(userContentController: WKUserContentController, didReceiveScriptMessage message: WKScriptMessage)</code>方法</p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="c1">//实现WKScriptMessageHandler委托</span>
     <span class="kd">class</span> <span class="kt">ViewController</span><span class="err">：</span><span class="kt">WKScriptMessageHandler</span>

     <span class="c1">//实现js调用ios的handle委托</span>
     <span class="kd">func</span> <span class="nf">userContentController</span><span class="p">(</span><span class="nv">userContentController</span><span class="p">:</span> <span class="kt">WKUserContentController</span><span class="p">,</span> <span class="n">didReceiveScriptMessage</span> <span class="nv">message</span><span class="p">:</span> <span class="kt">WKScriptMessage</span><span class="p">)</span> <span class="p">{</span>
         <span class="c1">//接受传过来的消息从而决定app调用的方法</span>
         <span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">body</span> <span class="k">as!</span> <span class="kt">Dictionary</span><span class="o">&lt;</span><span class="kt">String</span><span class="p">,</span><span class="kt">String</span><span class="o">&gt;</span>
         <span class="k">let</span> <span class="nv">method</span><span class="p">:</span><span class="kt">String</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"method"</span><span class="p">]</span><span class="o">!</span>
         <span class="k">let</span> <span class="nv">param1</span><span class="p">:</span><span class="kt">String</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"param1"</span><span class="p">]</span><span class="o">!</span>
         <span class="k">if</span> <span class="n">method</span><span class="o">==</span><span class="s">"hello"</span><span class="p">{</span>
             <span class="nf">hello</span><span class="p">(</span><span class="n">param1</span><span class="p">)</span>
         <span class="p">}</span>
     <span class="p">}</span>

</code></pre></div></div>

<p>3：js调用</p>

<p>通过 window.webkit.messageHandlers.webViewApp找到之前注册的handler对象，然后调用postMessage方法把数据传到app，app通过上一步的方法解析方法名和参数</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
        <span class="kd">var</span> <span class="nx">message</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="s1">'method'</span> <span class="p">:</span> <span class="s1">'hello'</span><span class="p">,</span>
                        <span class="s1">'param1'</span> <span class="p">:</span> <span class="s1">'liuyanwei'</span><span class="p">,</span>
                        <span class="p">};</span>
        <span class="nb">window</span><span class="p">.</span><span class="nx">webkit</span><span class="p">.</span><span class="nx">messageHandlers</span><span class="p">.</span><span class="nx">webViewApp</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span>

</code></pre></div></div>

<p>如果需要app对js的调用有所响应，可以通过回叫函数的方式回应js。可以在调用app的时候增加一个js回叫函数名 app在处理完之后可以呼叫回叫函数并把需要的参数通过回叫函数的方式进行传递</p>

<h3 id="webview生命周期和跳转代理">webView生命周期和跳转代理</h3>
<blockquote>
  <p>该代理提供的方法，可以用来追踪加载过程（页面开始加载、加载完成、加载失败）、决定是否执行跳转</p>
</blockquote>

<pre><code class="language-`swift">
// 页面开始加载时调用
- (void)webView:(WKWebView *)webView didStartProvisionalNavigation:(WKNavigation *)navigation;
// 当内容开始返回时调用
- (void)webView:(WKWebView *)webView didCommitNavigation:(WKNavigation *)navigation;
// 页面加载完成之后调用
- (void)webView:(WKWebView *)webView didFinishNavigation:(WKNavigation *)navigation;
// 页面加载失败时调用
- (void)webView:(WKWebView *)webView didFailProvisionalNavigation:(WKNavigation *)navigation;

// 接收到服务器跳转请求之后调用
- (void)webView:(WKWebView *)webView didReceiveServerRedirectForProvisionalNavigation:(WKNavigation *)navigation;
// 在收到响应后，决定是否跳转
- (void)webView:(WKWebView *)webView decidePolicyForNavigationResponse:(WKNavigationResponse *)navigationResponse decisionHandler:(void (^)(WKNavigationResponsePolicy))decisionHandler;
// 在发送请求之前，决定是否跳转
- (void)webView:(WKWebView *)webView decidePolicyForNavigationAction:(WKNavigationAction *)navigationAction decisionHandler:(void (^)(WKNavigationActionPolicy))decisionHandler;


</code></pre>

<h2 id="web页面">web页面</h2>
<hr />

<p>随便说两句web页面，demo中的web前段用了jquery去操作dom，btn是在js中添加的，btn的点击事件也在js中。另外随便写了几个css让页面稍微美观一些。web页面都在项目文件夹下的web文件夹中。大家其实也不必看，因为调用的app的js代码在文中都有单独贴出。</p>

<h2 id="参考文章">参考文章</h2>
<hr />
<blockquote>
  <p>本文也只是用了一些基本的用法，大家想了解更多，可以看看下面的三篇文章做补充阅读。但是现在也没发现有把webView这块写的很全很详细的文章，今后要是看见我会继续补充在这里。</p>
</blockquote>

<ul>
  <li><a href="http://nshipster.cn/wkwebkit/">WKWeb​View</a></li>
  <li><a href="http://www.cocoachina.com/ios/20150203/11089.html">iOS 8 WebKit框架概览（上）译文</a></li>
  <li><a href="http://www.cocoachina.com/ios/20150205/11108.html">iOS 8 WebKit框架概览（下）译文</a></li>
</ul>

<h2 id="demo">demo</h2>
<hr />
<p>我博客中大部分示例代码都上传到了github，地址是：https://github.com/coolnameismy/demo，<a href="https://github.com/coolnameismy/tree/master/demo">点击跳转代码下载地址</a></p>

<p>本文代码存放目录是ios-WebView,本demo没做界面自适应，为了保证效果请用iPhone6及以上模拟器打开</p>

<p>感谢收看，如果对大家有帮助，请<a href="https://github.com/coolnameismy">github上follow和star</a>，本文发布在<a href="https://zsmsimon.github.io/">刘彦玮的技术博客</a>，转载请注明出处</p>

<p>dome截图</p>

<p><img src="http://localhost:4000/assets/uploads/webview0.png" alt="" /></p>

<p><img src="http://localhost:4000/assets/uploads/webview1.png" alt="" /></p>

    <div class="declare">
        <div>

        </div>
    </div>
</article>
<!-- end #post__content -->

<div id="post__share">
  <a id="icon-twitter" class="fontello" href="https://twitter.com/intent/tweet?url=http://localhost:4000/2015/10/17/ios-webView.html&text=UIWebView和WKWebView的使用及js交互" target="_blank"></a>
  <a id="icon-cc" class="fontello" href="http://github.com/ZSMSimon" target="_blank"></a>
  <a id="icon-weibo" class="fontello" href="http://v.t.sina.com.cn/share/share.php?url=http://localhost:4000/2015/10/17/ios-webView.html&title=UIWebView和WKWebView的使用及js交互" target="_blank"></a>
    <!-- <div class="share-info">分享一下~</div> -->
</div>
<div id="qrcode" >
	<img src="http://localhost:4000/assets/images/qrcode.jpg" style="margin: 0 auto;display: block;" width="200" height="200" alt="">
</div>
<!-- end #post__share -->
<div id="disqus_thread" name="coolnameismy">
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>
</div>


            <!---->
    <!--<p id="copyright">Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>-->
    <!--&nbsp;&nbsp;|&nbsp;&nbsp;Theme <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll</a>-->
    <!--&nbsp;&nbsp;|&nbsp;&nbsp;Hosted on <a href="https://pages.github.com" target="_blank">Github</a></p>-->
      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">Table of Contents</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>

<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.pjax.js"></script>
<script src="/assets/js/nprogress.js"></script>
<script src="/assets/js/searchbox.js"></script>
<script src="/assets/js/script.js"></script>


    <script>
    //百度站点统计,排除localhost
    if(window.location.host.indexOf("localhost") ==-1 &&  window.location.host.indexOf("127.0.0.1") == -1){

        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?2c1583237ca3f5343d8dab0140019ca7";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }
</script>
   </body>
 </html>