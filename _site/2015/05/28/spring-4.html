<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="baidu-site-verification" content="w9Akh6dPe4" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<!--[if lte IE 8]><meta http-equiv="refresh" content="0;url=/ie.html"><![endif]-->

<title>Spring 文件上传 | 曾绍明的博客</title>
<meta name="author" content="曾绍明">

  <meta name="keywords" content="Spring,MVC,Rest,api,mysql">




<link rel="shortcut icon" href="" />

<link rel="stylesheet" type="text/css" href="/assets/css/style.css">

<link href="/pages/rss.xml" rel="alternate" title="曾绍明的博客" type="application/atom+xml">



  </head>
  <body>
        <aside id="sidebar">
  <nav id="tags">
    <a href="/index.html" id="avatar" style="background-image:url(https://avatars1.githubusercontent.com/u/15245912)"></a>

    <ul id="tags__ul">
      <li id="pl__all" class="tags__li tags-btn active">所有文章</li>
       
        <li id="技术" class="tags__li tags-btn">技术</li>
       
        <li id="web前端" class="tags__li tags-btn">web前端</li>
       
        <li id="专题" class="tags__li tags-btn">专题</li>
       
        <li id="iOS" class="tags__li tags-btn">iOS</li>
       
        <li id="生活" class="tags__li tags-btn">生活</li>
       
        <li id="react-native" class="tags__li tags-btn">react-native</li>
       
        <li id="其他" class="tags__li tags-btn">其他</li>
       
        <li id="IoT" class="tags__li tags-btn">IoT</li>
      
    </ul>

    <div id="tags__bottom">
      <a href="http://github.com/ZSMSimon" id="icon-github" class="tags-btn fontello" target="_blank"></a>
      <a href="/pages/rss.xml" id="icon-feed" class="tags-btn fontello" target="_blank"></a>
      <a href="mailto:ZSMSimon@163.com" id="icon-email" class="tags-btn fontello"></a>
    </div>
  </nav> <!-- end #tags -->

  <div id="posts-list">
    <form action="" id="search-form">
      <a href="/index.html" id="mobile-avatar" style="background-image:url(https://avatars1.githubusercontent.com/u/15245912)"></a>
      <!-- NOTE: input field is disabled by default -->
      <input id="search-input" type="text" placeholder="Search..." >
    </form>

    <nav id="pl__container">
    
      <a class="IoT pl__all" href="/2017/05/16/JavaScript-mqtt-temperaturedemo.html"><span class="pl__circle"></span><span class="pl__title">IoT技术选型及模型设计的思考</span><span class="pl__date">17/05/16</span></a>
    
      <a class="IoT pl__all" href="/2017/05/02/hello-nodemcu.html"><span class="pl__circle"></span><span class="pl__title">hello nodemcu</span><span class="pl__date">17/05/02</span></a>
    
      <a class="其他 pl__all" href="/2017/03/16/Recruitment.html"><span class="pl__circle"></span><span class="pl__title">阿里云iot事业部招聘信息</span><span class="pl__date">17/03/16</span></a>
    
      <a class="技术 pl__all" href="/2017/01/23/zhihu-live-a-hour-for-bluetooth-0.html"><span class="pl__circle"></span><span class="pl__title">知乎live：一小时蓝牙科普 文字整理版</span><span class="pl__date">17/01/23</span></a>
    
      <a class="web前端 pl__all" href="/2016/12/08/eslint-guide.html"><span class="pl__circle"></span><span class="pl__title">ESLint使用</span><span class="pl__date">16/12/08</span></a>
    
      <a class="其他 pl__all" href="/2016/12/06/how-to-fupan.html"><span class="pl__circle"></span><span class="pl__title">柳传志：我的复盘方法论</span><span class="pl__date">16/12/06</span></a>
    
      <a class="react-native pl__all" href="/2016/11/14/react-native-flux%E6%95%B0%E6%8D%AE%E6%B5%81.html"><span class="pl__circle"></span><span class="pl__title">flux数据流在rn中的使用</span><span class="pl__date">16/11/14</span></a>
    
      <a class="专题 pl__all" href="/2016/05/09/iOS-networking-0.html"><span class="pl__circle"></span><span class="pl__title">iOS 网络请求专题</span><span class="pl__date">16/05/09</span></a>
    
      <a class="iOS pl__all" href="/2016/04/03/iOS-JavaScriptCore.html"><span class="pl__circle"></span><span class="pl__title">iOS JavaScriptCore使用</span><span class="pl__date">16/04/03</span></a>
    
      <a class="iOS pl__all" href="/2016/04/02/iOS-3DTouch-3.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(三) Force Properties-按压力度</span><span class="pl__date">16/04/02</span></a>
    
      <a class="iOS pl__all" href="/2016/04/01/iOS-3DTouch-2.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(二) peek and pop - 预览和弹出</span><span class="pl__date">16/04/01</span></a>
    
      <a class="iOS pl__all" href="/2016/03/21/iOS-3DTouch-1.html"><span class="pl__circle"></span><span class="pl__title">iOS 3D touch开发(一) Home Screen Quick Actions</span><span class="pl__date">16/03/21</span></a>
    
      <a class="iOS pl__all" href="/2016/03/10/iOS-unit-test.html"><span class="pl__circle"></span><span class="pl__title">iOS单元测试</span><span class="pl__date">16/03/10</span></a>
    
      <a class="iOS pl__all" href="/2016/02/29/iOS-objc-styleguide.html"><span class="pl__circle"></span><span class="pl__title">iOS objc编程规范</span><span class="pl__date">16/02/29</span></a>
    
      <a class="iOS pl__all" href="/2016/02/13/ios-networking-5.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（五）网络请求中的cookie</span><span class="pl__date">16/02/13</span></a>
    
      <a class="iOS pl__all" href="/2016/02/09/ios-networking-4.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（四） http异步文件上传和下载以及进度指示</span><span class="pl__date">16/02/09</span></a>
    
      <a class="iOS pl__all" href="/2016/02/04/ios-networking-3.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（三） http异步请求和https认证</span><span class="pl__date">16/02/04</span></a>
    
      <a class="iOS pl__all" href="/2016/02/03/ios-networking-2.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（二） http异步队列请求</span><span class="pl__date">16/02/03</span></a>
    
      <a class="iOS pl__all" href="/2016/02/03/ios-networking-1.html"><span class="pl__circle"></span><span class="pl__title">iOS networking（一） http同步请求</span><span class="pl__date">16/02/03</span></a>
    
      <a class="react-native pl__all" href="/2016/02/02/react-native-demo.html"><span class="pl__circle"></span><span class="pl__title">react-native（二） 自己写的react-native学习demo和整理的tips</span><span class="pl__date">16/02/02</span></a>
    
      <a class="react-native pl__all" href="/2016/01/11/react-native-helloworld.html"><span class="pl__circle"></span><span class="pl__title">react-native（一） hello world</span><span class="pl__date">16/01/11</span></a>
    
      <a class="iOS pl__all" href="/2016/01/06/iOS-app-versions.html"><span class="pl__circle"></span><span class="pl__title">api如何设计才能支撑多个不同版本的app共存</span><span class="pl__date">16/01/06</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/31/playwith-imageToAscii.html"><span class="pl__circle"></span><span class="pl__title">那些好玩的nodejs插件 - 把图片转为ascii</span><span class="pl__date">15/12/31</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/10/fe-componentization.html"><span class="pl__circle"></span><span class="pl__title">前端开发框架 - seajs+handlebars模块化开发</span><span class="pl__date">15/12/10</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/06/fe-nginx-usage.html"><span class="pl__circle"></span><span class="pl__title">mac环境nginx的安装和使用</span><span class="pl__date">15/12/06</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/03/fe-js-handlebars.html"><span class="pl__circle"></span><span class="pl__title">handlerbars的使用及模板预编译</span><span class="pl__date">15/12/03</span></a>
    
      <a class="web前端 pl__all" href="/2015/12/01/fe-engineering-gulp.html"><span class="pl__circle"></span><span class="pl__title">gulp自动构建工具教程</span><span class="pl__date">15/12/01</span></a>
    
      <a class="web前端 pl__all" href="/2015/11/27/fe-environment.html"><span class="pl__circle"></span><span class="pl__title">前端开发工具和环境搭建</span><span class="pl__date">15/11/27</span></a>
    
      <a class="web前端 pl__all" href="/2015/11/26/rem-em-px.html"><span class="pl__circle"></span><span class="pl__title">css3属性rem的使用</span><span class="pl__date">15/11/26</span></a>
    
      <a class="生活 pl__all" href="/2015/11/26/mylift-github.html"><span class="pl__circle"></span><span class="pl__title">我每天都在github上做些什么</span><span class="pl__date">15/11/26</span></a>
    
      <a class="iOS pl__all" href="/2015/11/24/iOS-affine-transfermation-animation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（七）仿射变换-CGAffineTransform</span><span class="pl__date">15/11/24</span></a>
    
      <a class="iOS pl__all" href="/2015/11/22/iOS-library-spring.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（六）swift动画库spring使用和代码拆解</span><span class="pl__date">15/11/22</span></a>
    
      <a class="iOS pl__all" href="/2015/11/16/iOS-Implicit-Animation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（五）layer隐式动画</span><span class="pl__date">15/11/16</span></a>
    
      <a class="iOS pl__all" href="/2015/11/06/iOS-controller-transitioning.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（四）controller间的自定义过渡效果</span><span class="pl__date">15/11/06</span></a>
    
      <a class="iOS pl__all" href="/2015/11/01/iOS-MotionEffects.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（三）MotionEffects</span><span class="pl__date">15/11/01</span></a>
    
      <a class="iOS pl__all" href="/2015/10/30/iOS-UIKit-Dynamics.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（二）UIKit力学行为</span><span class="pl__date">15/10/30</span></a>
    
      <a class="iOS pl__all" href="/2015/10/30/iOS-Animation-UIViewAndCoreAnimation.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效（一）UIView动画和CoreAnimation</span><span class="pl__date">15/10/30</span></a>
    
      <a class="专题 pl__all" href="/2015/10/29/iOS-animation-0.html"><span class="pl__circle"></span><span class="pl__title">iOS动画和特效专题（零）- 大纲和计划</span><span class="pl__date">15/10/29</span></a>
    
      <a class="iOS pl__all" href="/2015/10/17/ios-webView.html"><span class="pl__circle"></span><span class="pl__title">UIWebView和WKWebView的使用及js交互</span><span class="pl__date">15/10/17</span></a>
    
      <a class="iOS pl__all" href="/2015/10/06/ios-swift-quick.html"><span class="pl__circle"></span><span class="pl__title">swift5分钟语法速记</span><span class="pl__date">15/10/06</span></a>
    
      <a class="iOS pl__all" href="/2015/09/20/ios-macro.html"><span class="pl__circle"></span><span class="pl__title">ios宏的使用和技巧</span><span class="pl__date">15/09/20</span></a>
    
      <a class="iOS pl__all" href="/2015/09/11/ios-BLE-4.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（四）BabyBluetooth蓝牙库介绍</span><span class="pl__date">15/09/11</span></a>
    
      <a class="iOS pl__all" href="/2015/09/07/ios-BLE-3.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（三）app作为外设被连接的实现</span><span class="pl__date">15/09/07</span></a>
    
      <a class="iOS pl__all" href="/2015/09/02/ios-draw-Graffiti-2.html"><span class="pl__circle"></span><span class="pl__title">ios绘图demo,做一个涂鸦板(下)</span><span class="pl__date">15/09/02</span></a>
    
      <a class="web前端 pl__all" href="/2015/08/29/go-deep-into-unsilder.js.html"><span class="pl__circle"></span><span class="pl__title">深入理解unslider.js源码</span><span class="pl__date">15/08/29</span></a>
    
      <a class="生活 pl__all" href="/2015/08/23/life-keyboardAndHHKB.html"><span class="pl__circle"></span><span class="pl__title">键盘那些事，hhkb开箱</span><span class="pl__date">15/08/23</span></a>
    
      <a class="技术 pl__all" href="/2015/08/22/github-ImagesUploadWebSite.html"><span class="pl__circle"></span><span class="pl__title">自己markdown博客的图床程序</span><span class="pl__date">15/08/22</span></a>
    
      <a class="iOS pl__all" href="/2015/08/19/ios-ThreadAndAsynchronization.html"><span class="pl__circle"></span><span class="pl__title">ios的线程和同步异步操作</span><span class="pl__date">15/08/19</span></a>
    
      <a class="iOS pl__all" href="/2015/08/14/ios-BLE-2.html"><span class="pl__circle"></span><span class="pl__title">ios蓝牙开发（二）ios连接外设的代码实现</span><span class="pl__date">15/08/14</span></a>
    
      <a class="iOS pl__all" href="/2015/07/26/ios-draw-Graffiti.html"><span class="pl__circle"></span><span class="pl__title">ios绘图demo,做一个涂鸦板(上)</span><span class="pl__date">15/07/26</span></a>
    
      <a class="iOS pl__all" href="/2015/07/25/ios-draw-base.html"><span class="pl__circle"></span><span class="pl__title">ios绘图基础</span><span class="pl__date">15/07/25</span></a>
    
      <a class="iOS pl__all" href="/2015/07/17/ios-BLE-1.html"><span class="pl__circle"></span><span class="pl__title">iOS蓝牙开发（一）蓝牙相关基础知识</span><span class="pl__date">15/07/17</span></a>
    
      <a class="专题 pl__all" href="/2015/07/17/ios-BLE-0.html"><span class="pl__circle"></span><span class="pl__title">iOS蓝牙的开发专题</span><span class="pl__date">15/07/17</span></a>
    
      <a class="技术 pl__all" href="/2015/07/07/mybatis.html"><span class="pl__circle"></span><span class="pl__title">MyBatis简单使用的demo</span><span class="pl__date">15/07/07</span></a>
    
      <a class="技术 pl__all" href="/2015/07/06/rabbitmq.html"><span class="pl__circle"></span><span class="pl__title">RabbitMQ使用</span><span class="pl__date">15/07/06</span></a>
    
      <a class="iOS pl__all" href="/2015/06/14/ios-library-masonry.html"><span class="pl__circle"></span><span class="pl__title">Masonry的使用</span><span class="pl__date">15/06/14</span></a>
    
      <a class="专题 pl__all" href="/2015/06/14/ios-library-0.html"><span class="pl__circle"></span><span class="pl__title">iOS中那些好用的第三方库</span><span class="pl__date">15/06/14</span></a>
    
      <a class="iOS pl__all" href="/2015/05/29/ios-develop-tool.html"><span class="pl__circle"></span><span class="pl__title">提高iOS开发效率的工具</span><span class="pl__date">15/05/29</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-4.html"><span class="pl__circle"></span><span class="pl__title">Spring 文件上传</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-3.html"><span class="pl__circle"></span><span class="pl__title">Spring- Hibernate数据基本操作</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-2.html"><span class="pl__circle"></span><span class="pl__title">Spring RestController 请求参数详解</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/spring-1.html"><span class="pl__circle"></span><span class="pl__title">Spring和hibernate的maven配置</span><span class="pl__date">15/05/28</span></a>
    
      <a class="技术 pl__all" href="/2015/05/28/tomcat-domain-name.html"><span class="pl__circle"></span><span class="pl__title">tomcat部署绑定多个域名</span><span class="pl__date">15/05/28</span></a>
    
      <a class="专题 pl__all" href="/2015/05/28/spring-0.html"><span class="pl__circle"></span><span class="pl__title">Spring4+hibernate专题</span><span class="pl__date">15/05/28</span></a>
    
      <a class="web前端 pl__all" href="/2015/04/29/css-selector.html"><span class="pl__circle"></span><span class="pl__title">css选择器的用法</span><span class="pl__date">15/04/29</span></a>
    
      <a class="技术 pl__all" href="/2014/02/12/how-to-deploy-a-blog-on-github-by-jekyll.html"><span class="pl__circle"></span><span class="pl__title">在Github上搭建Jekyll博客和创建主题</span><span class="pl__date">14/02/12</span></a>
    
      <a class="技术 pl__all" href="/2013/04/23/opensource-licenses.html"><span class="pl__circle"></span><span class="pl__title">五中常见的开源协议整理(BSD,Apache,GPL,LGPL,MIT)</span><span class="pl__date">13/04/23</span></a>
    
    </nav>
  </div> <!-- end #posts-list -->
</aside> <!-- end #sidebar -->
    <div id="post">
      <div id="pjax">
        <article id="post__content">
    <h1 id="post__title" data-identifier="20150528">Spring 文件上传</h1>
    <blockquote>
  <p>获取文件流的方法，已经在专题的“（二）Spring- RestController 请求参数详解” 中说过了，大家可以去找之前的获取方式。
 本篇主要讲的是文件上传的处理和保存。中间件使用的是tomcat。</p>
</blockquote>

<h2 id="1-文件上传配置">1. 文件上传配置</h2>
<p>文件上传需要增加一个依赖包</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;!--flieupload--&gt;
    &lt;dependency&gt;
        &lt;groupId&gt;commons-fileupload&lt;/groupId&gt;
        &lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;
        &lt;version&gt;1.3&lt;/version&gt;
    &lt;/dependency&gt;
</code></pre></div></div>

<p>在spring 的配置文件中，配置图片处理的bin文件</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    &lt;!-- 上传文件拦截，设置最大上传文件大小   10M=10*1024*1024(B)=10485760 bytes --&gt;
    &lt;bean id="multipartResolver" class="org.springframework.web.multipart.commons.CommonsMultipartResolver"&gt;
        &lt;property name="maxUploadSize" value="10485760" /&gt;
    &lt;/bean&gt;
</code></pre></div></div>

<h2 id="2-文件上传处理的方法">2. 文件上传处理的方法</h2>
<blockquote>
  <p>现在共有2个方法，大家还可以根据自己需求，把生成文件名的方法和生成缩略图大小的方法抽离出来，这里是示例，就不写那么复杂了。</p>
</blockquote>

<ul>
  <li>1单文件上传</li>
  <li>2单文件上传并自动生成缩略图</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilesService</span> <span class="o">{</span>

   <span class="c1">//文件相对Tomcat路径，相对tomcat设置，暂时弃用</span>
   <span class="c1">//public static final String FILE_PATH = "../user_res/upload/plantAssistant/";</span>

   <span class="c1">//文件相对网站路径</span>
   <span class="kd">public</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">FILE_PATH</span> <span class="o">=</span> <span class="s">"WEB-INF/upload"</span><span class="o">;</span>

       <span class="c1">//单文件上传</span>
       <span class="kd">public</span> <span class="kd">static</span> <span class="n">FilesResp</span> <span class="nf">uploadFile</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">file</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
           <span class="c1">//获取上传的路径</span>
           <span class="n">String</span> <span class="n">realpath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="n">FILE_PATH</span><span class="o">);</span>
           <span class="c1">//获取文件名</span>
           <span class="n">String</span> <span class="n">fileName</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>
           <span class="c1">//上传文件</span>
           <span class="n">File</span> <span class="n">tempFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">realpath</span><span class="o">,</span> <span class="k">new</span> <span class="n">Date</span><span class="o">().</span><span class="na">getTime</span><span class="o">()</span> <span class="o">+</span> <span class="s">"_"</span> <span class="o">+</span> <span class="n">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="n">fileName</span><span class="o">));</span>
           <span class="k">if</span> <span class="o">(!</span><span class="n">tempFile</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
               <span class="n">tempFile</span><span class="o">.</span><span class="na">getParentFile</span><span class="o">().</span><span class="na">mkdir</span><span class="o">();</span>
           <span class="o">}</span>
           <span class="k">if</span> <span class="o">(!</span><span class="n">tempFile</span><span class="o">.</span><span class="na">exists</span><span class="o">())</span> <span class="o">{</span>
               <span class="n">tempFile</span><span class="o">.</span><span class="na">createNewFile</span><span class="o">();</span>
           <span class="o">}</span>
           <span class="n">file</span><span class="o">.</span><span class="na">transferTo</span><span class="o">(</span><span class="n">tempFile</span><span class="o">);</span>

           <span class="c1">//处理返回值</span>
           <span class="n">FilesResp</span> <span class="n">fileResp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FilesResp</span><span class="o">(</span><span class="n">tempFile</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span><span class="n">getDomain</span><span class="o">(</span><span class="n">request</span><span class="o">));</span>
           <span class="k">return</span> <span class="n">fileResp</span><span class="o">;</span>
       <span class="o">}</span>

       <span class="c1">//单文件上传，并生成缩略图</span>
       <span class="kd">public</span> <span class="kd">static</span> <span class="n">FilesResp</span> <span class="nf">uploadFileAndThum</span><span class="o">(</span><span class="n">MultipartFile</span> <span class="n">file</span><span class="o">,</span> <span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">{</span>

           <span class="n">String</span> <span class="n">realpath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="n">FILE_PATH</span><span class="o">);</span>
           <span class="c1">//上传图片</span>
           <span class="n">FilesResp</span> <span class="n">fileResp</span> <span class="o">=</span> <span class="n">uploadFile</span><span class="o">(</span><span class="n">file</span><span class="o">,</span><span class="n">request</span><span class="o">);</span>

           <span class="c1">//生成缩略图</span>
           <span class="n">File</span> <span class="n">srcImageFile</span> <span class="o">=</span> <span class="k">new</span> <span class="n">File</span><span class="o">(</span><span class="n">realpath</span><span class="o">,</span><span class="n">fileResp</span><span class="o">.</span><span class="na">getFileName</span><span class="o">());</span>
           <span class="k">try</span> <span class="o">{</span>
               <span class="n">makeSmallImage</span><span class="o">(</span><span class="n">srcImageFile</span><span class="o">,</span><span class="n">realpath</span> <span class="o">+</span> <span class="s">"/thum_"</span><span class="o">+</span><span class="n">fileResp</span><span class="o">.</span><span class="na">getFileName</span><span class="o">());</span>
           <span class="o">}</span><span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
               <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"生成缩略图出错"</span><span class="o">);</span>
           <span class="o">}</span>
           <span class="k">return</span> <span class="k">new</span> <span class="nf">FilesResp</span><span class="o">(</span><span class="n">fileResp</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(),</span><span class="s">"thum_"</span><span class="o">+</span><span class="n">fileResp</span><span class="o">.</span><span class="na">getFileName</span><span class="o">(),</span><span class="n">getDomain</span><span class="o">(</span><span class="n">request</span><span class="o">));</span>

       <span class="o">}</span>


       <span class="kd">public</span> <span class="kd">static</span> <span class="n">File</span> <span class="nf">getFile</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="o">{</span>
           <span class="n">String</span> <span class="n">realpath</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getSession</span><span class="o">().</span><span class="na">getServletContext</span><span class="o">().</span><span class="na">getRealPath</span><span class="o">(</span><span class="n">FILE_PATH</span><span class="o">);</span>
           <span class="k">return</span> <span class="k">new</span> <span class="nf">File</span><span class="o">(</span><span class="n">realpath</span><span class="o">,</span> <span class="n">fileName</span><span class="o">);</span>
       <span class="o">}</span>

       <span class="cm">/**
            * 生成缩略图
            * @param srcImageFile 源图片文件的File实例      File file = new File("文件名");
            * @param dstImageFileName 待生成的缩略图片完整路径(生成的格式为：image/jpeg);
            * @throws Exception
            */</span>
           <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">makeSmallImage</span><span class="o">(</span><span class="n">File</span> <span class="n">srcImageFile</span><span class="o">,</span><span class="n">String</span> <span class="n">dstImageFileName</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
               <span class="n">FileOutputStream</span> <span class="n">fileOutputStream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
               <span class="n">JPEGImageEncoder</span> <span class="n">encoder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
               <span class="n">BufferedImage</span> <span class="n">tagImage</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
               <span class="n">Image</span> <span class="n">srcImage</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
               <span class="k">try</span><span class="o">{</span>
                   <span class="n">srcImage</span> <span class="o">=</span> <span class="n">ImageIO</span><span class="o">.</span><span class="na">read</span><span class="o">(</span><span class="n">srcImageFile</span><span class="o">);</span>
                   <span class="kt">int</span> <span class="n">srcWidth</span> <span class="o">=</span> <span class="n">srcImage</span><span class="o">.</span><span class="na">getWidth</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span><span class="c1">//原图片宽度</span>
                   <span class="kt">int</span> <span class="n">srcHeight</span> <span class="o">=</span> <span class="n">srcImage</span><span class="o">.</span><span class="na">getHeight</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span><span class="c1">//原图片高度</span>
                   <span class="kt">int</span> <span class="n">dstMaxSize</span> <span class="o">=</span> <span class="mi">120</span><span class="o">;</span><span class="c1">//目标缩略图的最大宽度/高度，宽度与高度将按比例缩写</span>
                   <span class="kt">int</span> <span class="n">dstWidth</span> <span class="o">=</span> <span class="n">srcWidth</span><span class="o">;</span><span class="c1">//缩略图宽度</span>
                   <span class="kt">int</span> <span class="n">dstHeight</span> <span class="o">=</span> <span class="n">srcHeight</span><span class="o">;</span><span class="c1">//缩略图高度</span>
                   <span class="kt">float</span> <span class="n">scale</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
                   <span class="c1">//计算缩略图的宽和高</span>
                   <span class="k">if</span><span class="o">(</span><span class="n">srcWidth</span><span class="o">&gt;</span><span class="n">dstMaxSize</span><span class="o">){</span>
                       <span class="n">dstWidth</span> <span class="o">=</span> <span class="n">dstMaxSize</span><span class="o">;</span>
                       <span class="n">scale</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">srcWidth</span><span class="o">/(</span><span class="kt">float</span><span class="o">)</span><span class="n">dstMaxSize</span><span class="o">;</span>
                       <span class="n">dstHeight</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">round</span><span class="o">((</span><span class="kt">float</span><span class="o">)</span><span class="n">srcHeight</span><span class="o">/</span><span class="n">scale</span><span class="o">);</span>
                   <span class="o">}</span>
                   <span class="n">srcHeight</span> <span class="o">=</span> <span class="n">dstHeight</span><span class="o">;</span>
                   <span class="k">if</span><span class="o">(</span><span class="n">srcHeight</span><span class="o">&gt;</span><span class="n">dstMaxSize</span><span class="o">){</span>
                       <span class="n">dstHeight</span> <span class="o">=</span> <span class="n">dstMaxSize</span><span class="o">;</span>
                       <span class="n">scale</span> <span class="o">=</span> <span class="o">(</span><span class="kt">float</span><span class="o">)</span><span class="n">srcHeight</span><span class="o">/(</span><span class="kt">float</span><span class="o">)</span><span class="n">dstMaxSize</span><span class="o">;</span>
                       <span class="n">dstWidth</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">round</span><span class="o">((</span><span class="kt">float</span><span class="o">)</span><span class="n">dstWidth</span><span class="o">/</span><span class="n">scale</span><span class="o">);</span>
                   <span class="o">}</span>
                   <span class="c1">//生成缩略图</span>
                   <span class="n">tagImage</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BufferedImage</span><span class="o">(</span><span class="n">dstWidth</span><span class="o">,</span><span class="n">dstHeight</span><span class="o">,</span><span class="n">BufferedImage</span><span class="o">.</span><span class="na">TYPE_INT_RGB</span><span class="o">);</span>
                   <span class="n">tagImage</span><span class="o">.</span><span class="na">getGraphics</span><span class="o">().</span><span class="na">drawImage</span><span class="o">(</span><span class="n">srcImage</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="n">dstWidth</span><span class="o">,</span><span class="n">dstHeight</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
                   <span class="n">fileOutputStream</span> <span class="o">=</span> <span class="k">new</span> <span class="n">FileOutputStream</span><span class="o">(</span><span class="n">dstImageFileName</span><span class="o">);</span>
                   <span class="n">encoder</span> <span class="o">=</span> <span class="n">JPEGCodec</span><span class="o">.</span><span class="na">createJPEGEncoder</span><span class="o">(</span><span class="n">fileOutputStream</span><span class="o">);</span>
                   <span class="n">encoder</span><span class="o">.</span><span class="na">encode</span><span class="o">(</span><span class="n">tagImage</span><span class="o">);</span>
                   <span class="n">fileOutputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                   <span class="n">fileOutputStream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
               <span class="o">}</span><span class="k">finally</span><span class="o">{</span>
                   <span class="k">if</span><span class="o">(</span><span class="n">fileOutputStream</span><span class="o">!=</span><span class="kc">null</span><span class="o">){</span>
                       <span class="k">try</span><span class="o">{</span>
                           <span class="n">fileOutputStream</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
                       <span class="o">}</span><span class="k">catch</span><span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                       <span class="o">}</span>
                       <span class="n">fileOutputStream</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                   <span class="o">}</span>
                   <span class="n">encoder</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                   <span class="n">tagImage</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                   <span class="n">srcImage</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
                   <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">();</span>
               <span class="o">}</span>
           <span class="o">}</span>

           <span class="c1">//获取域名</span>
           <span class="kd">private</span> <span class="kd">static</span> <span class="n">String</span> <span class="nf">getDomain</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">){</span>
               <span class="n">StringBuffer</span> <span class="n">url</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">();</span>
               <span class="k">return</span> <span class="n">url</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">url</span><span class="o">.</span><span class="na">length</span><span class="o">()</span> <span class="o">-</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURI</span><span class="o">().</span><span class="na">length</span><span class="o">(),</span> <span class="n">url</span><span class="o">.</span><span class="na">length</span><span class="o">()).</span><span class="na">toString</span><span class="o">();</span>
           <span class="o">}</span>
<span class="o">}</span>


</code></pre></div></div>

<h2 id="3方法的返回类型-filesresp">3方法的返回类型 FilesResp</h2>
<blockquote>
  <p>这个类型是我自己写的，大家也可以不用他，自己去定义，既然例子中有，我就把返回类型贴出来，里面的返回值生成了各种常用的标签，因为后面想搭一个自己的图库</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resp</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Resp</span> <span class="nf">succeedResp</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">){</span>
        <span class="n">Resp</span> <span class="n">resp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resp</span><span class="o">();</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="s">"返回成功"</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">;</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Resp</span> <span class="nf">succeedRespWithMsgAndData</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">,</span><span class="n">Object</span> <span class="n">data</span><span class="o">){</span>
        <span class="n">Resp</span> <span class="n">resp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resp</span><span class="o">();</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setData</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">;</span>

    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Resp</span> <span class="nf">succeedRespWithMsg</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">){</span>
        <span class="k">return</span> <span class="nf">succeedRespWithMsgAndData</span><span class="o">(</span><span class="n">msg</span><span class="o">,</span><span class="kc">null</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="n">Resp</span> <span class="nf">failureResp</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">){</span>
        <span class="n">Resp</span> <span class="n">resp</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Resp</span><span class="o">();</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setStatus</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">resp</span><span class="o">.</span><span class="na">setMsg</span><span class="o">(</span><span class="n">msg</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">resp</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="n">status</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">msg</span><span class="o">;</span>
    <span class="kd">protected</span> <span class="n">Object</span> <span class="n">data</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getStatus</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setStatus</span><span class="o">(</span><span class="kt">int</span> <span class="n">status</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">status</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMsg</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">msg</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMsg</span><span class="o">(</span><span class="n">String</span> <span class="n">msg</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">msg</span> <span class="o">=</span> <span class="n">msg</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">Object</span> <span class="nf">getData</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setData</span><span class="o">(</span><span class="n">Object</span> <span class="n">data</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">jumppo</span><span class="o">.</span><span class="na">plantassistant</span><span class="o">.</span><span class="na">dao</span><span class="o">.</span><span class="na">model</span><span class="o">.</span><span class="na">response</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.springframework.http.HttpRequest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">javax.servlet.http.HttpServletRequest</span><span class="o">;</span>

<span class="cm">/**
 * Created by zteliuyw on 15/7/13.
 */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FilesResp</span>  <span class="o">{</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">downloadUrl</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">previewUrl</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">htmlTag</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">aTag</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">mdTag</span><span class="o">;</span>

    <span class="kd">private</span> <span class="n">String</span> <span class="n">thum_fileName</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">thum_downloadUrl</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">thum_previewUrl</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">thum_htmlTag</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">thum_aTag</span><span class="o">;</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">thum_mdTag</span><span class="o">;</span>

    <span class="kd">public</span>  <span class="nf">FilesResp</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">){</span>

        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">downloadUrl</span> <span class="o">=</span> <span class="s">"/files/download?fileName="</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">=</span>   <span class="s">"/files/preview?fileName="</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">htmlTag</span> <span class="o">=</span> <span class="s">"&lt;img src=\" "</span><span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">+</span><span class="s">" \" /&gt;"</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">aTag</span> <span class="o">=</span> <span class="s">"&lt;a href=\"图片超链接地址\"&gt;&lt;img src=\" "</span><span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">+</span><span class="s">" \" /&gt;&lt;a&gt;"</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mdTag</span> <span class="o">=</span> <span class="s">"![图片文字：]("</span><span class="o">+</span>  <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">FilesResp</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">String</span> <span class="n">domain</span><span class="o">){</span>

        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">downloadUrl</span> <span class="o">=</span> <span class="n">domain</span> <span class="o">+</span> <span class="s">"/files/download?fileName="</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">=</span> <span class="n">domain</span> <span class="o">+</span> <span class="s">"/files/preview?fileName="</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">htmlTag</span> <span class="o">=</span> <span class="s">"&lt;img src=' "</span><span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">+</span><span class="s">" ' /&gt;"</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">aTag</span> <span class="o">=</span> <span class="s">"&lt;a href='图片超链接地址'&gt; &lt;img src='"</span><span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">+</span><span class="s">" ' /&gt;&lt;a&gt;"</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mdTag</span> <span class="o">=</span> <span class="s">"![图片文字：]("</span><span class="o">+</span>  <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="nf">FilesResp</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span><span class="n">String</span> <span class="n">thumFileName</span><span class="o">,</span><span class="n">String</span> <span class="n">domain</span><span class="o">){</span>

        <span class="k">this</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span> <span class="n">domain</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_fileName</span> <span class="o">=</span> <span class="n">thumFileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_downloadUrl</span> <span class="o">=</span> <span class="n">domain</span> <span class="o">+</span> <span class="s">"/files/download?fileName="</span> <span class="o">+</span> <span class="n">thumFileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_previewUrl</span> <span class="o">=</span> <span class="n">domain</span> <span class="o">+</span> <span class="s">"/files/preview?fileName="</span> <span class="o">+</span> <span class="n">thumFileName</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_htmlTag</span> <span class="o">=</span> <span class="s">"&lt;img src=' "</span><span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">thum_previewUrl</span> <span class="o">+</span><span class="s">" ' /&gt;"</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_aTag</span> <span class="o">=</span> <span class="s">"&lt;a href='图片超链接地址'&gt; &lt;img src='"</span><span class="o">+</span> <span class="k">this</span><span class="o">.</span><span class="na">thum_previewUrl</span> <span class="o">+</span><span class="s">" ' /&gt;&lt;a&gt;"</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_mdTag</span> <span class="o">=</span> <span class="s">"![图片文字：]("</span><span class="o">+</span>  <span class="k">this</span><span class="o">.</span><span class="na">thum_previewUrl</span> <span class="o">+</span> <span class="s">")"</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFileName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFileName</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fileName</span> <span class="o">=</span> <span class="n">fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getDownloadUrl</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">downloadUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDownloadUrl</span><span class="o">(</span><span class="n">String</span> <span class="n">downloadUrl</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">downloadUrl</span> <span class="o">=</span> <span class="n">downloadUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getPreviewUrl</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">previewUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setPreviewUrl</span><span class="o">(</span><span class="n">String</span> <span class="n">previewUrl</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">previewUrl</span> <span class="o">=</span> <span class="n">previewUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getHtmlTag</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">htmlTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setHtmlTag</span><span class="o">(</span><span class="n">String</span> <span class="n">htmlTag</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">htmlTag</span> <span class="o">=</span> <span class="n">htmlTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getaTag</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">aTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setaTag</span><span class="o">(</span><span class="n">String</span> <span class="n">aTag</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">aTag</span> <span class="o">=</span> <span class="n">aTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getMdTag</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">mdTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setMdTag</span><span class="o">(</span><span class="n">String</span> <span class="n">mdTag</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">mdTag</span> <span class="o">=</span> <span class="n">mdTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getThum_fileName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">thum_fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setThum_fileName</span><span class="o">(</span><span class="n">String</span> <span class="n">thum_fileName</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_fileName</span> <span class="o">=</span> <span class="n">thum_fileName</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getThum_downloadUrl</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">thum_downloadUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setThum_downloadUrl</span><span class="o">(</span><span class="n">String</span> <span class="n">thum_downloadUrl</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_downloadUrl</span> <span class="o">=</span> <span class="n">thum_downloadUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getThum_previewUrl</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">thum_previewUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setThum_previewUrl</span><span class="o">(</span><span class="n">String</span> <span class="n">thum_previewUrl</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_previewUrl</span> <span class="o">=</span> <span class="n">thum_previewUrl</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getThum_htmlTag</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">thum_htmlTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setThum_htmlTag</span><span class="o">(</span><span class="n">String</span> <span class="n">thum_htmlTag</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_htmlTag</span> <span class="o">=</span> <span class="n">thum_htmlTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getThum_aTag</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">thum_aTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setThum_aTag</span><span class="o">(</span><span class="n">String</span> <span class="n">thum_aTag</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_aTag</span> <span class="o">=</span> <span class="n">thum_aTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getThum_mdTag</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">thum_mdTag</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setThum_mdTag</span><span class="o">(</span><span class="n">String</span> <span class="n">thum_mdTag</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">thum_mdTag</span> <span class="o">=</span> <span class="n">thum_mdTag</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>



</code></pre></div></div>

<h2 id="4-最后是接受文件上传的控制器">4 最后是接受文件上传的控制器</h2>

<h4 id="有几点和大家说明下">有几点和大家说明下:</h4>
<ul>
  <li>
    <p>1:单个文件上传，路由参数这样写： @RequestParam(“file”) MultipartFile file，那么文件在表单中的name属性就必须是flie（不是文件名，是文件对应的name属性），这里是简单的写法,相当于
MultipartFile file = ((MultipartHttpServletRequest) request).getFile(“file”);</p>
  </li>
  <li>2:多个文件上传，参数@RequestParam(“files”) MultipartFile[] files</li>
  <li>3:下载和预览,这两个方法其实只相差一个地方，response.setHeader(“Content-Disposition”, “attachment; filename=” + fileName);，这段话会通知浏览器以下载的方式处理流</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>

<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/files"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">FliesController</span> <span class="o">{</span>



        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"upload"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="n">Resp</span> <span class="nf">upload</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                           <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">){</span>

            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"files/upload"</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">//MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;</span>
                <span class="n">FilesResp</span> <span class="n">filesResp</span> <span class="o">=</span> <span class="n">FilesService</span><span class="o">.</span><span class="na">uploadFile</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">Resp</span><span class="o">.</span><span class="na">succeedResp</span><span class="o">(</span><span class="n">filesResp</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">Resp</span><span class="o">.</span><span class="na">failureResp</span><span class="o">(</span><span class="s">"图片上传失败"</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"uploadFileAndThum"</span><span class="o">)</span>
        <span class="kd">public</span> <span class="n">Resp</span> <span class="nf">uploadFileAndThum</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                           <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span> <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"file"</span><span class="o">)</span> <span class="n">MultipartFile</span> <span class="n">file</span><span class="o">){</span>

            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"files/upload"</span><span class="o">);</span>
            <span class="k">try</span> <span class="o">{</span>
                <span class="c1">//MultipartHttpServletRequest multipartRequest = (MultipartHttpServletRequest) request;</span>
                <span class="n">FilesResp</span> <span class="n">filesResp</span> <span class="o">=</span> <span class="n">FilesService</span><span class="o">.</span><span class="na">uploadFileAndThum</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
                <span class="k">return</span> <span class="n">Resp</span><span class="o">.</span><span class="na">succeedResp</span><span class="o">(</span><span class="n">filesResp</span><span class="o">);</span>
            <span class="o">}</span>
            <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
                <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">Resp</span><span class="o">.</span><span class="na">failureResp</span><span class="o">(</span><span class="s">"图片上传失败"</span><span class="o">);</span>
        <span class="o">}</span>


    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"batchUpload"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">Resp</span> <span class="nf">batchUpload</span><span class="o">(</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">,</span>
                       <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span>
                       <span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"files"</span><span class="o">)</span> <span class="n">MultipartFile</span><span class="o">[]</span> <span class="n">files</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">FilesResp</span><span class="o">&gt;</span> <span class="n">list</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;</span><span class="n">FilesResp</span><span class="o">&gt;();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="k">for</span> <span class="o">(</span><span class="n">MultipartFile</span> <span class="n">file</span> <span class="o">:</span><span class="n">files</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">FilesResp</span> <span class="n">flesResp</span> <span class="o">=</span> <span class="n">FilesService</span><span class="o">.</span><span class="na">uploadFile</span><span class="o">(</span><span class="n">file</span><span class="o">,</span> <span class="n">request</span><span class="o">);</span>
                <span class="n">list</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">flesResp</span><span class="o">);</span>
<span class="c1">//                System.out.println("filePath:" + filePath);</span>
            <span class="o">}</span>
            <span class="k">return</span> <span class="n">Resp</span><span class="o">.</span><span class="na">succeedResp</span><span class="o">(</span><span class="n">list</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">catch</span> <span class="o">(</span><span class="n">Exception</span> <span class="n">e</span><span class="o">){</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span>  <span class="n">Resp</span><span class="o">.</span><span class="na">failureResp</span><span class="o">(</span><span class="s">"文件上传失败"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"download"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">download</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setHeader</span><span class="o">(</span><span class="s">"Content-Disposition"</span><span class="o">,</span> <span class="s">"attachment; filename="</span> <span class="o">+</span> <span class="n">fileName</span><span class="o">);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"image/jpeg; charset=utf-8"</span><span class="o">);</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">FileUtils</span><span class="o">.</span><span class="na">readFileToByteArray</span><span class="o">(</span><span class="n">FilesService</span><span class="o">.</span><span class="na">getFile</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span><span class="n">request</span><span class="o">)));</span>
            <span class="n">os</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">os</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"preview"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">preview</span><span class="o">(</span><span class="n">String</span> <span class="n">fileName</span><span class="o">,</span> <span class="n">HttpServletResponse</span> <span class="n">response</span><span class="o">,</span><span class="n">HttpServletRequest</span> <span class="n">request</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span> <span class="o">{</span>
        <span class="n">OutputStream</span> <span class="n">os</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getOutputStream</span><span class="o">();</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">response</span><span class="o">.</span><span class="na">reset</span><span class="o">();</span>
<span class="c1">//            response.setHeader("Content-Disposition", "attachment; filename=" + fileName);</span>
            <span class="n">response</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"image/jpeg; charset=utf-8"</span><span class="o">);</span>
            <span class="n">os</span><span class="o">.</span><span class="na">write</span><span class="o">(</span><span class="n">FileUtils</span><span class="o">.</span><span class="na">readFileToByteArray</span><span class="o">(</span><span class="n">FilesService</span><span class="o">.</span><span class="na">getFile</span><span class="o">(</span><span class="n">fileName</span><span class="o">,</span><span class="n">request</span><span class="o">)));</span>
            <span class="n">os</span><span class="o">.</span><span class="na">flush</span><span class="o">();</span>
        <span class="o">}</span> <span class="k">finally</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">os</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">os</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
            <span class="o">}</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<h4 id="返回的json例子">返回的json例子</h4>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    {
      "status": 1,
      "msg": "返回成功",
      "data": {
        "fileName": "1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png",
        "downloadUrl": "http://localhost:8070/files/download?fileName=1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png",
        "previewUrl": "http://localhost:8070/files/preview?fileName=1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png",
        "htmlTag": "&lt;img src=' http://localhost:8070/files/preview?fileName=1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png ' /&gt;",
        "aTag": "&lt;a href='图片超链接地址'&gt; &lt;img src='http://localhost:8070/files/preview?fileName=1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png ' /&gt;&lt;a&gt;",
        "mdTag": "![图片文字：](http://localhost:8070/files/preview?fileName=1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png)",
        "thum_fileName": "thum_1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png",
        "thum_downloadUrl": "http://localhost:8070/files/download?fileName=thum_1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png",
        "thum_previewUrl": "http://localhost:8070/files/preview?fileName=thum_1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png",
        "thum_htmlTag": "&lt;img src=' http://localhost:8070/files/preview?fileName=thum_1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png ' /&gt;",
        "thum_aTag": "&lt;a href='图片超链接地址'&gt; &lt;img src='http://localhost:8070/files/preview?fileName=thum_1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png ' /&gt;&lt;a&gt;",
        "thum_mdTag": "![图片文字：](http://localhost:8070/files/preview?fileName=thum_1436776126050_EEFC7812-B34E-43B1-9DCE-1CA965EE20B0.png)"
      }
    }
</code></pre></div></div>

    <div class="declare">
        <div>

        </div>
    </div>
</article>
<!-- end #post__content -->

<div id="post__share">
  <a id="icon-twitter" class="fontello" href="https://twitter.com/intent/tweet?url=http://localhost:4000/2015/05/28/spring-4.html&text=Spring 文件上传" target="_blank"></a>
  <a id="icon-cc" class="fontello" href="http://github.com/ZSMSimon" target="_blank"></a>
  <a id="icon-weibo" class="fontello" href="http://v.t.sina.com.cn/share/share.php?url=http://localhost:4000/2015/05/28/spring-4.html&title=Spring 文件上传" target="_blank"></a>
    <!-- <div class="share-info">分享一下~</div> -->
</div>
<div id="qrcode" >
	<img src="http://localhost:4000/assets/images/qrcode.jpg" style="margin: 0 auto;display: block;" width="200" height="200" alt="">
</div>
<!-- end #post__share -->
<div id="disqus_thread" name="coolnameismy">
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  <a href="http://disqus.com" class="dsq-brlink" target="_blank">Loading Disqus comments...</a>
</div>


            <!---->
    <!--<p id="copyright">Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a>-->
    <!--&nbsp;&nbsp;|&nbsp;&nbsp;Theme <a href="https://github.com/P233/3-Jekyll" target="_blank">3-Jekyll</a>-->
    <!--&nbsp;&nbsp;|&nbsp;&nbsp;Hosted on <a href="https://pages.github.com" target="_blank">Github</a></p>-->
      </div> <!-- end #pjax -->

      <div id="post__toc-trigger">
        <div id="post__toc">
          <span id="post__toc-title">Table of Contents</span>
          <ul id="post__toc-ul"></ul>
        </div>
      </div>
    </div> <!-- end #post -->

    <button id="js-fullscreen"><span id="icon-arrow" class="fontello"></span></button>

<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.pjax.js"></script>
<script src="/assets/js/nprogress.js"></script>
<script src="/assets/js/searchbox.js"></script>
<script src="/assets/js/script.js"></script>


    <script>
    //百度站点统计,排除localhost
    if(window.location.host.indexOf("localhost") ==-1 &&  window.location.host.indexOf("127.0.0.1") == -1){

        var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?2c1583237ca3f5343d8dab0140019ca7";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    }
</script>
   </body>
 </html>